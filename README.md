# 星知文章管理后端项目

## 此项目使用的技术栈为：
1. Java
2. MyBatis
3. MyBatis Plus
4. Spring Boot
5. Slf4j
6. Lombok
7. gson
8. jasypt
9. hutool
10. jsonwebtoken

## 项目MySQL初始化文件位于项目一级目录mysql -> xingz_cm.sql

## 项目亮点：
1. 使用Redis进行用户登录凭证版本(token version)进行存储和认证，实现单用户登录
2. 使用API签名认证实现API接口保护，包括防重放攻击和防参数篡改
3. 使用自定义注解实现API频率控制和自定义注解实现访问控制
4. 编写自定义Spring Boot Starter并发布Maven仓库，为了简化代码编写，封装代码的重复操作和增加代码的可维护性
5. 使用RBAC来动态控制管理员权限，并每个角色的权限可以进行动态更改
6. 自定义注解实现权限控制
7. 分页查询防爬虫
8. 自定义注解进行API签名认证，对非本APP来源请求进行拒绝
9. 使用自定义注解实现用户和管理员的登录校验及验证
10. 使用自定义注解实现API接口的频控，功能包括同一接口的重复注解使用完成自定义频控流速，还包括选择将什么作为频控的依据，例如：uuid，IP等

## 登录
![image](https://cdn.staticaly.com/gh/Kkuil/picx-images-hosting@master/20230708/image.3do37unegs60.webp)

## 星知文章用户后台项目源码链接：[https://github.com/Kkuil/XingzCMBms](https://github.com/Kkuil/XingzCMBms)
## 星知文章后端项目源码链接：[https://github.com/Kkuil/XingzCMBackend](https://github.com/Kkuil/XingzCMBackend)

## 如何进行API接口保护
### 1. 如何保证访问者的合法性？
前后配合使用同一种复杂的数据加密算法，将加密后的数据加在请求头中，发送给后端，，后端再采用同样的加密算法对数据进行加密，查看是否与前端请求头中传来的sign值是否一致，别人如果不知道这种算法，将拿到了参数也没办法脱离app或web网页进行数据请求。
### 2. 如何保证参数不被修改？
想想一下这样一种场景，如果我们有一个分页查询的接口，需要传递参数如下：
current=1&pageSize=10&is_onbargin=1，别人想要更改current或者pageSize来拿到其他页的数据，只要我们做了第一步，将会同时保证参数不会被修改，因为参数一旦被修改，请求头中sign值也要跟着变，因为后端就是根据参数加密与请求头中的sign进行比对，查看是否一致来验证请求是否合法
例如：非法请求者修改了current为2,进行http请求，后端在拿到参数后进行加密比对的时候就会发现sign值不一致直接Access denied
### 3. 如何确保请求的唯一性？
在前端进行请求时，在请求参数上带上一个唯一值nonce，当一次合法请求到达后端后，后端进行nonce记录，这里可以使用缓存技术进行记录，例如redis，等下一次如果有人再次使用这个请求时，后端首先进行nonce查询，是否未被使用
#### （1）这个时候就会有人想，既然后端不进行存储未被使用的nonce，也就是说nonce是可以你自己生成的，那我自己随机生成一个不就行了，保证了未被使用性，但是你要知道nonce也是参与加密算法的，又回到了一开始那个问题，非法请求者要是不知道加密算法，一样无法计算出sign，从而无法修改sign_value，就无法通过后端Sign校验
#### （2）这时就有人问了，难道nonce要一直存在于redis中吗，这不是增加服务器开销吗？当然不是，当你使用redis存储时，可以在存储时设置过期时间和因为和下面说的时效性相对应，只有在合法时间之内发送的请求才被后端所“认可”，其他请求就无法被“认可”
### 4. 如何保证请求的时效性？
我们既然要对接口进行保护，当然就要对每个请求的失效进行保证，不要让非法请求者就算能够通过校验也无法长时间使用同一种方式攻击我们的服务器，从而导致服务器宕机，这个时候我们就要添加时间戳ts参数了，当后端拿到了时间戳参数就可以自己校验当前请求是否在合法范围内，有人又问了时间戳我改一下不就完事了吗，比如说我通过某种方式知道了接口的时效性为5分钟，我只要将时间戳改到和当前时间戳相差小于5分钟就行了呀，但是犯和上一个问题同样的错误，时间戳也是参与加密算法的，改动时间戳，就相当于改动了后端算出sign的值，除非你有本事将后端算出sign的值也改了。
### 5. 如果算法泄露，攻击者知道了算法，我们又该如何保护我们接口？
加密算法采用非对称加密，例如：RSA等，这样一来就算攻击者知道了我们的加密算法，他无得到secretKey，就无法通过算法和密钥进行计算sign，也就无法进行攻击
## 总结
如果一个请求者需要对我们的app进行攻击，需要满足以下几个条件：
### 1. 知道加密算法
### 2. 知道secretKey秘钥

# 项目外话题之项目心得体会
1. 在进行项目开发过程中，单元测试少，没有单元测试的习惯，以后需要养成单元测试的习惯
2. 在进行后端代码的书写的时候，需多考虑功能的健壮性，不要草草了事，不然后期代码维护会比较困难
3. 养成良好的代码书写规范，多参考大厂的一些数据库命名规范，接口规范等
4. 在接口参数进行封装的时候，进行参数鲜明，让别人（一般是前端程序员）能够更快的理解接口参数含义，从而加快项目开发进度
5. 在项目开发过程中，遇到的难以解决的bug，我们就可以先去开发其他的功能模块，不要一直停留在一个bug上，不然会拖慢整个项目开发周期
6. 在使用java中请求拦截器中获取请求体参数时，要使用request.getReader()进行字节流读取
7. 对于API签名机制还是不太了解，花了挺多时间研究，发现不管是ChatGPT还是网上的CSDN给出的答案都不一致，让我想了好久，最终还是决定去看一下鱼皮的api教程，我觉得应该有我想要的东西
8. 在后端使用了swagger文档后，可以直接扔给使用了ant design pro模板的前端，让前端根据oneapi规范进行自动生成接口请求的代码
9. 在进行前台样式编写的时候，碰到了当元素能占满整个页面，不出现垂直滚动条的时候，横向滚动条也不会出现，当垂直滚动条出现的时候，横向滚动条也出现了，初步发现是因为没有垂直滚动跳的时候html元素的宽度为1536px，而一旦出现了垂直滚动条就变成了1519.2px，比子元素宽度小，从而宽度不够，继而出现了横向滚动条
10. 在使用axios发送get请求时，请求参数若是带有嵌套的对象，则在进行参数拼接时，就会带上[]，例如：
    ```javascript
        return await request.get("/tag", {
        method: "GET",
        params:{
            page: {
                current: 1,
                pageSize: 10
            }
        }
    })
    ```
11. 学习SCSS/SASS语法，SCSS预编译器很强大，变量，混合mixin，继承，循环
12. 在后端使用MyBatisPlus进行数据库操作时，我们进行增添一条数据，如果此时数据库中有一条数据的唯一字段与当前将插入的数据的唯一字段一致，则插入失败，因为在进行查询是否有重复值的是时候（select语句）并不能查出来那条isDeleted为1的数据，只有在插入的时候，由数据库报错，用户才能感知到。
13. Delta富文本内容存储媒介，然后前端vue可以使用dompurify库进行富文本的html转换并过滤存在潜在XSS攻击的内容
14. 当进行普通字段和文件上传容到一个接口时，必须要把请求头Content-Type设置为multipart/form-data,不然将会报错，无法接收文件
    ```SQL
    Resolved [org.springframework.http.converter.HttpMessageConversionException: Type definition error: [simple type, class org.springframework.web.multipart.MultipartFile]]
    ```
15. 当使用@Value注解进行application.yml文件属性的注入时，该字段不能为静态变量，否则注入失败，主要是说不是注入失败，而是失败了还不报错
16. 项目中使用了vue的自定义指令进行文章滑动动画效果的实现和下拉选择框点击外部隐藏下拉框的实现
17. 在后台管理系统中，对于文章数据统计（如喜欢数、收藏数、评论数等），我们通常会设计以下几个功能：
    ```
    1. 数据展示：展示文章的统计数据，如喜欢数、收藏数、评论数等。这些数据可以实时更新，也可以定期更新。数据展示是必要的，因为管理员需要了解文章的受欢迎程度以便进行内容策划和运营决策。
2. 数据统计：对文章数据进行统计分析。例如，计算文章的平均喜欢数、收藏数、评论数，或者找出热门文章、热门作者等。数据统计对于分析用户行为和优化内容策略非常重要。
3. 增删改查功能：对于喜欢数、收藏数、评论数等数据，一般来说不需要开发增删改查功能。因为这些数据是用户在前台通过点赞、收藏、评论等操作产生的，后台管理员不应该直接修改这些数据。但是，对于文章和评论本身，可能需要提供增删改查功能，以便管理员管理和维护网站内容。
    ```
18. 在进行分页查询业务开发时，一定要考虑好使用MyBatisPlus还是使用XML映射文件进行数据库操作，推荐在复杂场景下，使用XML映射文件，更易于维护和拓展，但是可移植性下降，但是一定得根据自己的实际业务场景出发，提前决定好，不然就会像我一样一直修改一直修改
19. 当项目过大时，springboot启动时，将要加载许多bean，使得启动时间大大增加，不利于项目开发，所以这时就需要开启类似于前端图片懒加载的功能的配置了，在springboot中刚好有这样的配置，当开启下列配置时就可以让springboot在启动项目时，只加载启动需要用到的bean：
    ```Java
    spring:
      	main:
      	# bean 懒加载
      		lazy-initialization: true
    ```
20. 在进行主键类型定义的时候，尽量选择Long类型，因为Long类型可以表示的数值大，占用空间小
21. 需要加强自己的并发编程能力，例如：加锁（悲观锁，乐观锁），线程池，能解决秒杀问题
22. 多利用注解去解决问题
23. 可以自定义一个注解实现频控（频率控制），并且要实现可以使用多次注解来实现分批次限流
24. 当你的项目中使用了tailwindcss的时候，需要住一个问题，就是tailwindcss无法动态生成类名，例如：
    ```HTML
    <div class="`line-clamp-[${MAX_SHOW_LINE}]`"></div>
    ```
25. 多进行博客书写
