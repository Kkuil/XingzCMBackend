# 星知文章管理后端项目

## 此项目使用的技术栈为：
1. Java
2. MyBatis
3. MyBatis Plus
4. Spring Boot
5. Slf4j
6. Lombok
7. gson
8. jasypt
9. hutool
10. jsonwebtoken

## 项目亮点：
1. 使用Redis进行用户登录凭证版本(token version)进行存储和认证，实现单用户登录
2. 使用API签名认证实现API接口保护，包括防重放攻击和防参数篡改
3. 使用自定义注解实现API频率控制和自定义注解实现访问控制
4. 编写自定义Spring Boot Starter并发布Maven仓库，为了简化代码编写，封装代码的重复操作和增加代码的可维护性
5. 使用RBAC来动态控制管理员权限，并每个角色的权限可以进行动态更改
6. 自定义注解实现权限控制
7. 分页查询防爬虫
8. 自定义注解进行API签名认证，对非本APP来源请求进行拒绝
9. 使用自定义注解实现用户和管理员的登录校验及验证
10. 使用自定义注解实现API接口的频控，功能包括同一接口的重复注解使用完成自定义频控流速，还包括选择将什么作为频控的依据，例如：uuid，IP等

![image]https://cdn.staticaly.com/gh/Kkuil/picx-images-hosting@master/20230708/image.1c0gc2jtnluo.webp

## 星知文章用户后台项目源码链接：[https://github.com/Kkuil/XingzCMBms](https://github.com/Kkuil/XingzCMBms)
## 星知文章后端项目源码链接：[https://github.com/Kkuil/XingzCMBackend](https://github.com/Kkuil/XingzCMBackend)

## 如何进行API接口保护
### 1. 如何保证访问者的合法性？
前后配合使用同一种复杂的数据加密算法，将加密后的数据加在请求头中，发送给后端，，后端再采用同样的加密算法对数据进行加密，查看是否与前端请求头中传来的sign值是否一致，别人如果不知道这种算法，将拿到了参数也没办法脱离app或web网页进行数据请求。
### 2. 如何保证参数不被修改？
想想一下这样一种场景，如果我们有一个分页查询的接口，需要传递参数如下：
current=1&pageSize=10&is_onbargin=1，别人想要更改current或者pageSize来拿到其他页的数据，只要我们做了第一步，将会同时保证参数不会被修改，因为参数一旦被修改，请求头中sign值也要跟着变，因为后端就是根据参数加密与请求头中的sign进行比对，查看是否一致来验证请求是否合法
例如：非法请求者修改了current为2,进行http请求，后端在拿到参数后进行加密比对的时候就会发现sign值不一致直接Access denied
### 3. 如何确保请求的唯一性？
在前端进行请求时，在请求参数上带上一个唯一值nonce，当一次合法请求到达后端后，后端进行nonce记录，这里可以使用缓存技术进行记录，例如redis，等下一次如果有人再次使用这个请求时，后端首先进行nonce查询，是否未被使用
#### （1）这个时候就会有人想，既然后端不进行存储未被使用的nonce，也就是说nonce是可以你自己生成的，那我自己随机生成一个不就行了，保证了未被使用性，但是你要知道nonce也是参与加密算法的，又回到了一开始那个问题，非法请求者要是不知道加密算法，一样无法计算出sign，从而无法修改sign_value，就无法通过后端Sign校验
#### （2）这时就有人问了，难道nonce要一直存在于redis中吗，这不是增加服务器开销吗？当然不是，当你使用redis存储时，可以在存储时设置过期时间和因为和下面说的时效性相对应，只有在合法时间之内发送的请求才被后端所“认可”，其他请求就无法被“认可”
### 4. 如何保证请求的时效性？
我们既然要对接口进行保护，当然就要对每个请求的失效进行保证，不要让非法请求者就算能够通过校验也无法长时间使用同一种方式攻击我们的服务器，从而导致服务器宕机，这个时候我们就要添加时间戳ts参数了，当后端拿到了时间戳参数就可以自己校验当前请求是否在合法范围内，有人又问了时间戳我改一下不就完事了吗，比如说我通过某种方式知道了接口的时效性为5分钟，我只要将时间戳改到和当前时间戳相差小于5分钟就行了呀，但是犯和上一个问题同样的错误，时间戳也是参与加密算法的，改动时间戳，就相当于改动了后端算出sign的值，除非你有本事将后端算出sign的值也改了。
### 5. 如果算法泄露，攻击者知道了算法，我们又该如何保护我们接口？
加密算法采用非对称加密，例如：RSA等，这样一来就算攻击者知道了我们的加密算法，他无得到secretKey，就无法通过算法和密钥进行计算sign，也就无法进行攻击
## 总结
如果一个请求者需要对我们的app进行攻击，需要满足以下几个条件：
### 1. 知道加密算法
### 2. 知道secretKey秘钥
